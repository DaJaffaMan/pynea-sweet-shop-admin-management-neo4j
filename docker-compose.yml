version: "3.9" 

services:
  machine-graph:
    build: 
      context: ./api
      dockerfile: ./machine.Dockerfile
      target: development
    platform: linux/amd64
    ports: 
      - 4000:4000
      - 9229:9229
    volumes:
      - ./src/:/usr/api/machine/src
      - ./api/.env:/usr/api/machine/.env
      - ~/.config/gcloud:/home/node/.config/gcloud
    env_file:
      - ./api/.env
    depends_on:
      - neo4j
    command: npm run install:start:dev

  neo4j:
    image: neo4j:latest
    ports:
      - 7474:7474
    volumes:
      - ./neo4j/data:/var/lib/neo4j/data
      - ./neo4j/import:/var/lib/neo4j/import
      - ./neo4j/logs:/var/lib/neo4j/logs
    environment:
      NEO4J_AUTH: neo4j/password
